// packages/core/utils/element.ts
function isEqualElementType(element, elementThen) {
  if (element.type === elementThen.type) {
    return true;
  }
  return false;
}

// packages/core/htmlParser.ts
var idx = BigInt(1);
function createInsNode(node) {
  const insNode = {
    id: idx++,
    type: "Element" /* Element */,
    tagName: "ins",
    attrs: [],
    children: [node],
    pid: node.pid
  };
  node.pid = insNode.id;
  return insNode;
}
function createDelNode(node) {
  const delNode = {
    id: idx++,
    type: "Element" /* Element */,
    tagName: "del",
    attrs: [],
    children: [node],
    pid: node.pid
  };
  node.pid = delNode.id;
  return delNode;
}

// packages/transform/transformDiff.ts
function transformDiff(ast, context) {
  const diffAst = context.diffAst;
  const oldStack = [diffAst];
  const newStack = [ast];
  const parentMap = {};
  const peddingMap = {};
  while (oldStack.length || newStack.length) {
    let isPushChildren = true;
    let oldNode = oldStack.pop();
    let newNode = newStack.pop();
    const oldParentNode = oldNode && parentMap[oldNode.pid];
    const newParentNode = newNode && parentMap[newNode.pid];
    if (oldNode) {
      parentMap[oldNode.id] = oldNode;
    }
    if (newNode) {
      parentMap[newNode.id] = newNode;
    }
    if (oldNode && newNode) {
      if (isEqualElementType(oldNode, newNode)) {
        if (oldNode.type === "Text" /* Text */) {
          if (oldNode.content !== newNode.content) {
            insert(addDiffType(oldNode, 1 /* removed */), newParentNode, null);
            insert(addDiffType(newNode, 0 /* added */), newParentNode, newNode);
          }
        } else if (oldNode.type === "Element" /* Element */) {
          if (oldNode.tagName !== newNode.tagName) {
            isPushChildren = false;
            insert(addDiffType(oldNode, 1 /* removed */), newParentNode, null);
            insert(addDiffType(newNode, 0 /* added */), newParentNode, newNode);
          }
        } else {
        }
      } else {
        insert(addDiffType(oldNode, 1 /* removed */), newParentNode, null);
        insert(addDiffType(newNode, 0 /* added */), newParentNode, newNode);
      }
    } else if (oldNode) {
      insert(addDiffType(oldNode, 1 /* removed */), oldParentNode, oldNode);
    } else if (newNode) {
      insert(addDiffType(newNode, 0 /* added */), newParentNode, newNode);
    }
    if (oldNode && (oldNode.type === "Element" /* Element */ || oldNode.type === "Root" /* Root */) && isPushChildren) {
      oldStack.push(...oldNode.children);
    }
    if (newNode && (newNode.type === "Element" /* Element */ || newNode.type === "Root" /* Root */) && isPushChildren) {
      newStack.push(...newNode.children);
    }
  }
  return () => {
  };
}
function addDiffType(node, diffType) {
  node.diffType = diffType;
  const diffNode = createDiffNode(node);
  return diffNode;
}
function createDiffNode(node) {
  if (node.diffType === 0 /* added */) {
    return createInsNode(node);
  } else if (node.diffType === 1 /* removed */) {
    return createDelNode(node);
  } else {
    return node;
  }
}
function insert(newNode, container, anchor) {
  if (anchor) {
    const findNodeIndex = container.children.findIndex((node) => node === anchor);
    container.children.splice(findNodeIndex, 1, newNode);
  } else {
    container.children.unshift(newNode);
  }
}

// packages/transform/transformText.ts
function transformText(node, context) {
  return function postformText() {
    const { tag, props } = node;
  };
}
export {
  transformDiff,
  transformText
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vcGFja2FnZXMvY29yZS91dGlscy9lbGVtZW50LnRzIiwgIi4uLy4uL3BhY2thZ2VzL2NvcmUvaHRtbFBhcnNlci50cyIsICIuLi8uLi9wYWNrYWdlcy90cmFuc2Zvcm0vdHJhbnNmb3JtRGlmZi50cyIsICIuLi8uLi9wYWNrYWdlcy90cmFuc2Zvcm0vdHJhbnNmb3JtVGV4dC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtUYWdTdGF0ZX0gZnJvbSAnLi9pbmRleCdcclxuXHJcbmV4cG9ydCBjb25zdCB1bmFyeSA9IFtcclxuICBcImJyXCIsXHJcbiAgXCJoclwiLFxyXG4gIFwiaW1nXCIsXHJcbiAgXCJpbnB1dFwiLFxyXG4gIFwibWV0YVwiLFxyXG4gIFwibGlua1wiLFxyXG4gIFwiYXJlYVwiLFxyXG4gIFwiYmFzZVwiLFxyXG4gIFwiY29sXCIsXHJcbiAgXCJjb21tYW5kXCIsXHJcbiAgXCJlbWJlZFwiLFxyXG4gIFwia2V5Z2VuXCIsXHJcbiAgXCJwYXJhbVwiLFxyXG4gIFwic291cmNlXCIsXHJcbiAgXCJ0cmFja1wiLFxyXG4gIFwid2JyXCJcclxuXTtcclxuZXhwb3J0IGZ1bmN0aW9uIGlzVW5hcnkodGFnTmFtZSk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiB1bmFyeS5pbmNsdWRlcyh0YWdOYW1lKTtcclxufVxyXG4gIFxyXG4vKlx1N0VEM1x1Njc1Rlx1NjgwN1x1N0I3RSovXHJcbmV4cG9ydCBmdW5jdGlvbiBjbG9zZUVsZW1lbnQoZWxlbWVudCkge1xyXG4gIGlmKGVsZW1lbnQudW5hcnkpIHtcclxuICAgIGVsZW1lbnQudGFnU3RhdHVzID0gVGFnU3RhdGUudGFnRW5kO1xyXG4gIH1cclxufVxyXG4vKipcclxuICogXHU1QkY5XHU2QkQ0XHU1MTQzXHU3RDIwXHU2NjJGXHU1NDI2XHU3NkY4XHU1NDBDXHU3QzdCXHU1NzhCXHJcbiAqIEBwYXJhbSBlbGVtZW50IFxyXG4gKiBAcGFyYW0gZWxlbWVudFRoZW4gXHJcbiAqIEByZXR1cm5zIFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRXF1YWxFbGVtZW50VHlwZShlbGVtZW50LCBlbGVtZW50VGhlbik6IGJvb2xlYW4ge1xyXG4gIGlmKGVsZW1lbnQudHlwZSA9PT0gZWxlbWVudFRoZW4udHlwZSkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufSIsICJpbXBvcnQge1RleHRNb2RlcywgVGFnU3RhdGUsIGFkdmFuY2VCeSwgYWR2YW5jZVNwYWNlcywgaXNVbmFyeSwgY2xvc2VFbGVtZW50LCB0b2dnbGVNb2RlLCByZXZlcnRNb2RlfSBmcm9tICcuL3V0aWxzL2luZGV4J1xyXG5pbXBvcnQge19wYXJzZXJPcHRpb25zLCBwYXJzZXJPcHRpb25zLCBwYXJzZXJDb250ZXh0LCBIVE1MTm9kZVR5cGUsIEVsZW1lbnROb2RlLCBUZXh0Tm9kZSwgUm9vdE5vZGUsIENvbW1lbnROb2RlLCBOb2RlfSBmcm9tICcuL3R5cGVzJ1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRva2VuaXplKHRlbXBsYXRlKSB7XHJcbiAgLyoqXHJcbiAgICogXHU4RjkzXHU1MTY1XHVGRjFBPGRpdj4xMjM8L2Rpdj5cclxuICAgKiBcdThGOTNcdTUxRkE6IFt7IHR5cGU6IHRhZ09wZW4sIHRhZ05hbWU6ICdkaXYnIH0sIHsgdHlwZTogdGV4dCwgY29udGVudDogJzEyMycgfSwgeyB0eXBlOiB0YWdFbmQsIHRhZ05hbWU6ICdkaXYnIH1dXHJcbiAgICovXHJcbiAgY29uc3QgdG9rZW5zID0gW107XHJcbiAgXHJcbiAgcmV0dXJuIHRva2VucztcclxufVxyXG5cclxubGV0IGlkeCA9IEJpZ0ludCgxKTtcclxuZXhwb3J0IGNsYXNzIEhUTUxQYXJzZXIge1xyXG4gIHByaXZhdGUgX29wdGlvbnM6IF9wYXJzZXJPcHRpb25zO1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IHBhcnNlck9wdGlvbnMgPSB7fSkge1xyXG4gICAgdGhpcy5fb3B0aW9ucyA9IHtcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgICAgaWQ6IGlkeFxyXG4gICAgfTtcclxuICB9XHJcbiAgcGFyc2VyKHRlbXBsYXRlKSB7XHJcbiAgICBjb25zdCByb290OiBSb290Tm9kZSA9IHtcclxuICAgICAgaWQ6IHRoaXMuX29wdGlvbnMuaWQrKyxcclxuICAgICAgdHlwZTogSFRNTE5vZGVUeXBlLlJvb3QsXHJcbiAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgcGlkOiBCaWdJbnQoMCksXHJcbiAgICB9O1xyXG4gICAgY29uc3QgY29udGV4dDogcGFyc2VyQ29udGV4dCA9IHtcclxuICAgICAgICBzb3VyY2U6IHRlbXBsYXRlLFxyXG4gICAgICAgIG1vZGU6IFRleHRNb2Rlcy5EQVRBLFxyXG4gICAgICAgIG9sZE1vZGU6IFRleHRNb2Rlcy5EQVRBLFxyXG4gICAgICAgIHR5cGU6IEhUTUxOb2RlVHlwZS5Sb290LFxyXG4gICAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgICBwaWQ6IHJvb3QuaWQsXHJcbiAgICB9XHJcbiAgICByb290LmNoaWxkcmVuID0gdGhpcy5wYXJzZUNoaWxkcmVuKGNvbnRleHQpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gcm9vdFxyXG4gIH1cclxuICBwYXJzZUNoaWxkcmVuKGNvbnRleHQsIGFuY2VzdG9ycyA9IFtdKTogTm9kZVtdIHtcclxuICAgICAgbGV0IG5vZGVzOiBOb2RlW10gPSBbXTtcclxuICAgICAgLy8gXHU0RUNFXHU0RTBBXHU0RTBCXHU2NTg3XHU1QkY5XHU4QzYxXHU0RTJEXHU1M0Q2XHU1Rjk3XHU1RjUzXHU1MjREXHU3MkI2XHU2MDAxXHVGRjBDXHU1MzA1XHU2MkVDXHU2QTIxXHU1RjBGIG1vZGUgXHU1NDhDXHU2QTIxXHU2NzdGXHU1MTg1XHU1QkI5XHJcbiAgICBcclxuICAgICAgd2hpbGUgKHRoaXMuaXNFbmQoY29udGV4dCwgYW5jZXN0b3JzKSkge1xyXG4gICAgICAgIGNvbnN0IHttb2RlLCBzb3VyY2UsIHBpZH0gPSBjb250ZXh0O1xyXG4gICAgICAgIGxldCBub2RlOy8vIFx1NTNFQVx1NjcwOSBEQVRBIFx1NkEyMVx1NUYwRlx1NTQ4QyBSQ0RBVEEgXHU2QTIxXHU1RjBGXHU2MjREXHU2NTJGXHU2MzAxXHU2M0QyXHU1MDNDXHU4MjgyXHU3MEI5XHU3Njg0XHU4OUUzXHU2NzkwXHJcbiAgICAgICAgaWYgKG1vZGUgPT09IFRleHRNb2Rlcy5EQVRBIHx8IG1vZGUgPT09IFRleHRNb2Rlcy5SQ0RBVEEpIHtcclxuICAgICAgICAgIC8vIFx1NTNFQVx1NjcwOSBEQVRBIFx1NkEyMVx1NUYwRlx1NjI0RFx1NjUyRlx1NjMwMVx1NjgwN1x1N0I3RVx1ODI4Mlx1NzBCOVx1NzY4NFx1ODlFM1x1Njc5MFxyXG4gICAgICAgICAgaWYgKHNvdXJjZS5zdGFydHNXaXRoKFwiPCFbQ0RBVEFbXCIpKSB7XHJcbiAgICAgICAgICAgIC8vIENEQVRBXHJcbiAgICAgICAgICAgIHRvZ2dsZU1vZGUoY29udGV4dCwgVGV4dE1vZGVzLkNEQVRBKTtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICB9ZWxzZSBpZihtb2RlID09PSBUZXh0TW9kZXMuREFUQSAmJiBzb3VyY2VbMF0gPT09IFwiPFwiKSB7XHJcbiAgICAgICAgICAgIGlmKHNvdXJjZVsxXSA9PT0gJyEnKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHNvdXJjZS5zdGFydHNXaXRoKFwiPCEtLVwiKSkge1xyXG4gICAgICAgICAgICAgICAgLy9cdTZDRThcdTkxQ0FcclxuICAgICAgICAgICAgICAgIG5vZGUgPSB0aGlzLnBhcnNlQ29tbWVudChjb250ZXh0LCBhbmNlc3RvcnMpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2UgaWYoL1thLXpdL2kudGVzdChzb3VyY2VbMV0pKSB7XHJcbiAgICAgICAgICAgICAgLy9cdTY4MDdcdTdCN0VcclxuICAgICAgICAgICAgICBub2RlID0gdGhpcy5wYXJzZUVsZW1lbnQoY29udGV4dCwgYW5jZXN0b3JzKTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoc291cmNlWzFdID09PSAnLycpIHtcclxuICAgICAgICAgICAgICAvL1x1N0VEM1x1Njc1Rlx1NjgwN1x1N0I3RVx1NzJCNlx1NjAwMVxyXG4gICAgICAgICAgICAgIHJldHVybiBub2RlcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfWVsc2UgaWYgKG1vZGUgPT09IFRleHRNb2Rlcy5SQ0RBVEEgfHwgbW9kZSA9PT0gVGV4dE1vZGVzLkRBVEEgJiYgc291cmNlWzFdID09PSBcIi9cIikge1xyXG4gICAgICAgICAgICAvL1x1N0VEM1x1Njc1Rlx1NjgwN1x1N0I3RVx1RkYwQ1x1OEZEOVx1OTFDQ1x1OTcwMFx1ODk4MVx1NjI5Qlx1NTFGQVx1OTUxOVx1OEJFRlx1RkYwQ1x1NTQwRVx1NjU4N1x1NEYxQVx1OEJFNlx1N0VDNlx1ODlFM1x1OTFDQVx1NTM5Rlx1NTZFMFxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJcdTRFMERcdTY2MkZEQVRBXHU2QTIxXHU1RjBGXCIpO1xyXG4gICAgICAgICAgfWVsc2UgaWYoc291cmNlLnN0YXJ0c1dpdGgoXCJ7e1wiKSkge1xyXG4gICAgICAgICAgICAvL1x1NjNEMlx1NTAzQ1x1ODlFM1x1Njc4NFxyXG4gICAgICAgICAgICBub2RlID0gdGhpcy5wYXJzZUludGVycG9sYXRpb24oY29udGV4dCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyBub2RlIFx1NEUwRFx1NUI1OFx1NTcyOFx1RkYwQ1x1OEJGNFx1NjYwRVx1NTkwNFx1NEU4RVx1NTE3Nlx1NEVENlx1NkEyMVx1NUYwRlx1RkYwQ1x1NTM3M1x1OTc1RSBEQVRBIFx1NkEyMVx1NUYwRlx1NEUxNFx1OTc1RSBSQ0RBVEEgXHU2QTIxXHU1RjBGXHJcbiAgICAgICAgICBpZighbm9kZSkge1xyXG4gICAgICAgICAgICBub2RlID0gdGhpcy5wYXJzZVRleHQoY29udGV4dCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBub2RlLnBpZCA9IHBpZFxyXG4gICAgICAgICAgbm9kZXMucHVzaChub2RlKTtcclxuICAgICAgICB9ZWxzZSBpZihtb2RlID09PSBUZXh0TW9kZXMuQ0RBVEEpIHtcclxuICAgICAgICAgIGlmIChzb3VyY2Uuc3RhcnRzV2l0aChcIjwhW0NEQVRBW1wiKSkge1xyXG4gICAgICAgICAgICAvLyBDREFUQVxyXG4gICAgICAgICAgICBub2RlID0gdGhpcy5wYXJzZUNEQVRBKGNvbnRleHQsIGFuY2VzdG9ycyk7XHJcbiAgICAgICAgICAgIHJldmVydE1vZGUoY29udGV4dCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBub2Rlcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbm9kZXM7XHJcbiAgfVxyXG4gIGlzRW5kKGNvbnRleHQsIGFuY2VzdG9ycykge1xyXG4gICAgLy9cdTUxNDNcdTdEMjBcdTY4MDgsXHU1RjUzXHU1MjREXHU1QjUwXHU1MTQzXHU3RDIwXHU2NzA5XHU1QkY5XHU1RTk0XHU2ODA4XHJcbiAgICAvLyBmb3IobGV0IGkgPSAwOyBpIDwgYW5jZXN0b3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAvLyAgIGlmKGFuY2VzdG9yc1tpXS50YWcpIHtcclxuICAgIC8vICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIC8vICAgfVxyXG4gICAgLy8gfVxyXG4gICAgaWYoY29udGV4dC5zb3VyY2UpIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG4gICAgXHJcbiAgcGFyc2VUZXh0KGNvbnRleHQpOiBUZXh0Tm9kZSB7XHJcbiAgICBsZXQge21vZGUsIHNvdXJjZX0gPSBjb250ZXh0O1xyXG4gICAgLy9cdTUzMzlcdTkxNERcdTdFQUZcdTY1ODdcdTY3MkNcclxuICAgIGNvbnN0IG1hdGNoID0gc291cmNlLm1hdGNoKC9bXjw+XSovKTtcclxuICAgIGxldCBjb250ZW50ID0gJyc7XHJcbiAgICBpZihtYXRjaFswXSkge1xyXG4gICAgICBhZHZhbmNlQnkoY29udGV4dCwgbWF0Y2hbMF0ubGVuZ3RoKTtcclxuICAgICAgY29udGVudCA9IG1hdGNoWzBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IHRoaXMuX29wdGlvbnMuaWQrKyxcclxuICAgICAgdHlwZTogSFRNTE5vZGVUeXBlLlRleHQsXHJcbiAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsXHJcbiAgICAgIHBpZDogY29udGV4dC5waWRcclxuICAgIH1cclxuICB9XHJcbiAgcGFyc2VJbnRlcnBvbGF0aW9uKGNvbnRleHQpIHtcclxuICAgIGNvbnN0IHtzb3VyY2V9ID0gY29udGV4dDtcclxuICAgIGNvbnN0IG1hdGNoID0gc291cmNlLm1hdGNoKC9eXFx7XFx7XFxzKiguKj8pXFxzKlxcfVxcfS8pO1xyXG4gICAgYWR2YW5jZUJ5KGNvbnRleHQsIG1hdGNoWzBdLmxlbmd0aCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IHRoaXMuX29wdGlvbnMuaWQrKyxcclxuICAgICAgdHlwZTogSFRNTE5vZGVUeXBlLkludGVycG9sYXRpb24sXHJcbiAgICAgIGNvbnRlbnQ6IFttYXRjaFswXSwgbWF0Y2hbMV1dLFxyXG4gICAgICBwaWQ6IGNvbnRleHQucGlkXHJcbiAgICB9XHJcbiAgfVxyXG4gIHBhcnNlRWxlbWVudChjb250ZXh0LCBhbmNlc3RvcnMpOiBFbGVtZW50Tm9kZSB7XHJcbiAgICBsZXQge3NvdXJjZX0gPSBjb250ZXh0O1xyXG4gIFxyXG4gICAgY29uc3QgbWF0Y2ggPSBzb3VyY2UubWF0Y2goL148KFthLXpdW2EtekEtWi1dKikvKTtcclxuICAgIGlmKCFtYXRjaCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJcdTY4MDdcdTdCN0VcdTY4M0NcdTVGMEZcdTRFMERcdTZCNjNcdTc4NkVcIik7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0YWdOYW1lID0gbWF0Y2hbMV07XHJcbiAgICBjb25zdCBpc1VuYXJ5VGFnID0gaXNVbmFyeSh0YWdOYW1lKTtcclxuXHJcbiAgICBjb250ZXh0LnNvdXJjZSA9IHNvdXJjZS5zbGljZShtYXRjaFswXS5sZW5ndGgpO1xyXG4gICAgY29uc3QgZWxlbWVudCA9IHsgLy9cdThGRDlcdTRFMkFcdTcyQjZcdTYwMDFcdTY4MDhcdUZGMENcdTVCNTBcdTUxNDNcdTdEMjBcdTk3MDBcdTg5ODFcdTUzMzlcdTkxNERcdTVCODNcdTY2MkZcdTU0MjZcdTk3MDBcdTg5ODFcdTk1RURcdTU0MDgsXHU2MjE2XHU4MDA1XHU1QjgzXHU1M0VGXHU4MEZEXHU2NjJGXHU4MUVBXHU5NUVEXHU1NDA4XHU3Njg0XHU2ODA3XHU3QjdFXHJcbiAgICAgIHRhZ1N0YXR1czogVGFnU3RhdGUudGFnTmFtZSwgLy9cdTUxODVcdTVCQjlcdTcyQjZcdTYwMDFcclxuICAgICAgdGFnTmFtZTogdGFnTmFtZSwgLy9cdTY4MDdcdTdCN0VcdTU0MERcdTc5RjBcclxuICAgICAgdW5hcnk6IGlzVW5hcnlUYWcsXHJcbiAgICB9ICBcclxuICAgIC8vMS5cdTUzMzlcdTkxNERcdTUxNDNcdTdEMjBcdTVDNUVcdTYwMjdcclxuICAgIGNvbnN0IGF0dHJzID0gdGhpcy5wYXJzZUF0dHJpYnV0ZShjb250ZXh0LCBlbGVtZW50KTtcclxuICAgIGNvbnN0IEVsZW1lbnROb2RlOiBFbGVtZW50Tm9kZSA9IHtcclxuICAgICAgaWQ6IHRoaXMuX29wdGlvbnMuaWQrKyxcclxuICAgICAgdHlwZTogSFRNTE5vZGVUeXBlLkVsZW1lbnQsXHJcbiAgICAgIHRhZ05hbWU6IHRhZ05hbWUsXHJcbiAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgYXR0cnM6IGF0dHJzLFxyXG4gICAgICBwaWQ6IGNvbnRleHQucGlkLFxyXG4gICAgfVxyXG5cclxuICAgIGlmKGlzVW5hcnlUYWcpIHtcclxuICAgICAgY2xvc2VFbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBhbmNlc3RvcnMucHVzaChlbGVtZW50KTtcclxuICAgICAgLy8yLlx1NTMzOVx1OTE0RFx1NTE0M1x1N0QyMFx1NTE4NVx1NUJCOSwgXHU2NzA5XHU1QjUwXHU1MTQzXHU3RDIwXHU1QzMxXHU1RjAwXHU1NDJGXHU3MkI2XHU2MDAxXHU2NzNBXHJcbiAgICAgIGVsZW1lbnQudGFnU3RhdHVzID0gVGFnU3RhdGUudGV4dDtcclxuICAgICAgLy9cdTUzMzlcdTkxNERcdTVDM0VcdTVERjRcdTUxODVcdTVCQjlcclxuICAgICAgY29uc3QgbWF0Y2hUYWdFbmQgPSBjb250ZXh0LnNvdXJjZS5tYXRjaChgKC4qPyk8XFxcXC8ke3RhZ05hbWV9PmApO1xyXG4gIFxyXG4gICAgICBpZihtYXRjaFRhZ0VuZCkge1xyXG4gICAgICAgIGNvbnRleHQucGlkID0gRWxlbWVudE5vZGUuaWQ7XHJcbiAgICAgICAgRWxlbWVudE5vZGUuY2hpbGRyZW4gPSB0aGlzLnBhcnNlQ2hpbGRyZW4oY29udGV4dCwgYW5jZXN0b3JzKTtcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlx1NjgwN1x1N0I3RVx1NUZDNVx1OTg3Qlx1ODk4MVx1NjcwOVx1N0VEM1x1Njc1RlwiKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBhbmNlc3RvciA9IGFuY2VzdG9ycy5wb3AoKTsgLy9cdTkwMDBcdTUxRkFcdTY4MDhcclxuICAgICAgaWYoYW5jZXN0b3IpIHtcclxuICAgICAgICBhZHZhbmNlQnkoY29udGV4dCwgYW5jZXN0b3IudGFnTmFtZS5sZW5ndGgrMik7XHJcbiAgICAgICAgYWR2YW5jZVNwYWNlcyhjb250ZXh0KTtcclxuICAgICAgICBhZHZhbmNlQnkoY29udGV4dCwgMSk7XHJcbiAgICAgIH1lbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJcdTRFMERcdTU0MDhcdTZDRDVcdTc2ODRcdTY4MDdcdTdCN0VcIik7XHJcbiAgICAgIH1cclxuICAgICAgLy8zLlx1NTMzOVx1OTE0RDwvLi4uPlxyXG4gICAgICAvLzIuXHU2RDg4XHU4RDM5XHU2NUY2XHVGRjBDXHU2OEMwXHU2RDRCXHU2QTIxXHU2NzdGXHU2NjJGXHU1NDI2XHU1QjU4XHU1NzI4IC8+XHVGRjBDXHU1OTgyXHU2NzlDXHU2NzA5XHU1MjE5XHU4ODY4XHU3OTNBXHU1MTc2XHU0RTNBXHU4MUVBXHU5NUVEXHU1NDA4XHU2ODA3XHU3QjdFXHVGRjBDXHU5NzAwXHU4OTgxXHU1MDVBXHU1MUZBXHU2ODA3XHU2Q0U4XHJcbiAgICAgIC8vMy5cdTVCOENcdTYyMTBcdTZCNjNcdTUyMTlcdTUzMzlcdTkxNERcdTU0MEVcdUZGMENcdTk3MDBcdTg5ODFcdThDMDNcdTc1MjggYWR2YW5jZUJ5IFx1NTFGRFx1NjU3MFx1NkQ4OFx1OEQzOVx1NzUzMVx1NkI2M1x1NTIxOVx1NTMzOVx1OTE0RFx1NzY4NFx1NTE2OFx1OTBFOFx1NTE4NVx1NUJCOVxyXG4gICAgICAvLzQuXHU1OTgyXHU2NzlDXHU4MUVBXHU5NUVEXHU1NDA4XHVGRjBDXHU1MjE5IGFkdmFuY2VCeSBcdTZEODhcdThEMzkgLz5cclxuICAgIH1cclxuICAgIHJldHVybiBFbGVtZW50Tm9kZTtcclxuICB9XHJcbiAgXHJcbiAgcGFyc2VBdHRyaWJ1dGUoY29udGV4dCwgZWxlbWVudCkge1xyXG4gICAgLy9cdTg5RTNcdTY3OTBcdTVDNUVcdTYwMjdcdUZGMENcdTYzMDdcdTRFRTR2LWlmLHYtbW9kZWwsXHU0RThCXHU0RUY2QGV2ZW50LCB2LW9uOmV2ZW50TmFtZSwgdjpiaW5kOm5hbWUuc3luY1xyXG4gICAgY29uc3QgYXR0clJlZyA9IC8oOj9bYS16QS1aXVthLXpBLVotXSopXFxzKig/Oig9KVxccyooPzooW1wiJ10pKFteXCInPD5dKilcXDN8KFteXFxzXCInPD5dKikpKT8vXHJcbiAgXHJcbiAgICBjb25zdCBhdHRyaWJ1dGVzOiBzdHJpbmdbXVtdID0gW107XHJcbiAgICBhZHZhbmNlU3BhY2VzKGNvbnRleHQpO1xyXG4gICAgbGV0IGF0dHJNYXRjaDtcclxuICAgIHdoaWxlKGNvbnRleHQuc291cmNlWzBdICE9PSAnPCcgJiYgY29udGV4dC5zb3VyY2VbMF0gIT09ICc+Jykge1xyXG4gICAgICAvL1x1NkQ4OFx1OTY2NFx1N0E3QVx1NjgzQ1xyXG4gICAgICBhdHRyTWF0Y2ggPSBjb250ZXh0LnNvdXJjZS5tYXRjaChhdHRyUmVnKTtcclxuICBcclxuICAgICAgYWR2YW5jZUJ5KGNvbnRleHQsIGF0dHJNYXRjaFswXS5sZW5ndGgpOyAvL1x1NkQ4OFx1OTY2NFx1NUM1RVx1NjAyN1xyXG4gIFxyXG4gICAgICAvLyBbJ3YtaWY9XCJpc1Nob3dcIicsICd2LWlmJywgJz0nLCAnaXNTaG93J10sICAgXHJcbiAgICAgIC8vIFsnY2xhc3M9XCJoZWFkZXJcIicsICdjbGFzcycsICc9JywgJ2hlYWRlciddXHJcbiAgICAgIGF0dHJpYnV0ZXMucHVzaChbYXR0ck1hdGNoWzBdLCBhdHRyTWF0Y2hbMV0sIGF0dHJNYXRjaFsyXSwgYXR0ck1hdGNoWzRdXSk7XHJcbiAgXHJcbiAgICAgIC8vXHU2RDg4XHU5NjY0XHU3QTdBXHU2ODNDXHJcbiAgICAgIGFkdmFuY2VTcGFjZXMoY29udGV4dCk7XHJcbiAgICAgIGlmKGNvbnRleHQuc291cmNlWzBdID09PSAnLycgJiYgZWxlbWVudC51bmFyeSkge1xyXG4gICAgICAgIC8vXHU4MUVBXHU5NUVEXHU1NDA4XHU2ODA3XHU3QjdFXHJcbiAgICAgICAgYWR2YW5jZUJ5KGNvbnRleHQsIDEpO1xyXG4gICAgICB9XHJcbiAgICAgIGFkdmFuY2VTcGFjZXMoY29udGV4dCk7XHJcbiAgICB9XHJcbiAgICBhZHZhbmNlQnkoY29udGV4dCwgMSk7IC8vXHU2RDg4XHU5NjY0PlxyXG4gIFxyXG4gICAgcmV0dXJuIGF0dHJpYnV0ZXM7XHJcbiAgfVxyXG4gIC8vXHU2Q0U4XHU5MUNBXHJcbiAgcGFyc2VDb21tZW50KGNvbnRleHQsIGFuY2VzdG9ycyk6IENvbW1lbnROb2RlIHtcclxuICAgIGxldCB7c291cmNlfSA9IGNvbnRleHQ7XHJcbiAgICBsZXQgdmFsdWUgPSAnJzsgLy9cdTZDRThcdTkxQ0FcdTUxODVcdTVCQjlcclxuICBcclxuICAgIHNvdXJjZSA9IHNvdXJjZS5zbGljZSg0KTtcclxuICAgIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKC8oW1xcc1xcU10qPykoLS0+KS8sIGZ1bmN0aW9uKG1hdGNoLCAkMSwgJDIpIHtcclxuICAgICAgdmFsdWUgPSAkMTtcclxuICAgICAgcmV0dXJuICQyID8gJDIgOiAnJztcclxuICAgIH0pO1xyXG4gICAgaWYoc291cmNlLnN0YXJ0c1dpdGgoXCItLT5cIikpIHtcclxuICAgICAgY29udGV4dC5zb3VyY2UgPSBzb3VyY2Uuc2xpY2UoMyk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgIC8vXHU2MjE2XHU4MDA1XHU2MjRCXHU1MkE4XHU5NUVEXHU1NDA4XHJcbiAgICAgIHZhbHVlID0gY29udGV4dC5zb3VyY2U7XHJcbiAgICAgIGNvbnRleHQuc291cmNlID0gJyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpZDogdGhpcy5fb3B0aW9ucy5pZCsrLFxyXG4gICAgICB0eXBlOiBIVE1MTm9kZVR5cGUuQ29tbWVudCxcclxuICAgICAgY29udGVudDogdmFsdWUsXHJcbiAgICAgIHBpZDogY29udGV4dC5waWRcclxuICAgIH1cclxuICB9XHJcbiAgcGFyc2VDREFUQShjb250ZXh0LCBhbmNlc3RvcnMpIHtcclxuICAgIGNvbnN0IGNkYXRhTWF0Y2ggPSBjb250ZXh0LnNvdXJjZS5tYXRjaCgvXjwhXFxbQ0RBVEFcXFsoW1xcc1xcU10qPylcXF1cXF0vKTtcclxuICAgIGFkdmFuY2VCeShjb250ZXh0LCBjZGF0YU1hdGNoWzBdLmxlbmd0aCk7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkOiB0aGlzLl9vcHRpb25zLmlkKyssXHJcbiAgICAgIHR5cGU6IEhUTUxOb2RlVHlwZS5DREFUQSxcclxuICAgICAgY29udGVudDogY2RhdGFNYXRjaFsxXSxcclxuICAgICAgcGlkOiBjb250ZXh0LnBpZFxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUluc05vZGUobm9kZSkge1xyXG4gIC8vIFx1NTIxQlx1NUVGQWluc1x1ODI4Mlx1NzBCOVx1RkYwQ1x1NUU3Nlx1NTkwRFx1NTIzNlx1NTM5Rlx1ODI4Mlx1NzBCOVx1NzY4NFx1NUM1RVx1NjAyN1x1NTQ4Q1x1NUI1MFx1ODI4Mlx1NzBCOVxyXG4gIGNvbnN0IGluc05vZGU6IEVsZW1lbnROb2RlID0ge1xyXG4gICAgICBpZDogaWR4KyssXHJcbiAgICAgIHR5cGU6IEhUTUxOb2RlVHlwZS5FbGVtZW50LFxyXG4gICAgICB0YWdOYW1lOiAnaW5zJyxcclxuICAgICAgYXR0cnM6IFtdLFxyXG4gICAgICBjaGlsZHJlbjogW25vZGVdLFxyXG4gICAgICBwaWQ6IG5vZGUucGlkLFxyXG4gIH07XHJcbiAgbm9kZS5waWQgPSBpbnNOb2RlLmlkO1xyXG4gIHJldHVybiBpbnNOb2RlO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWxOb2RlKG5vZGUpIHtcclxuICAvLyBcdTUyMUJcdTVFRkFkZWxcdTgyODJcdTcwQjlcdUZGMENcdTVFNzZcdTU5MERcdTUyMzZcdTUzOUZcdTgyODJcdTcwQjlcdTc2ODRcdTVDNUVcdTYwMjdcdTU0OENcdTVCNTBcdTgyODJcdTcwQjlcclxuICBjb25zdCBkZWxOb2RlOiBFbGVtZW50Tm9kZSA9IHtcclxuICAgICAgaWQ6IGlkeCsrLFxyXG4gICAgICB0eXBlOiBIVE1MTm9kZVR5cGUuRWxlbWVudCxcclxuICAgICAgdGFnTmFtZTogJ2RlbCcsXHJcbiAgICAgIGF0dHJzOiBbXSxcclxuICAgICAgY2hpbGRyZW46IFtub2RlXSxcclxuICAgICAgcGlkOiBub2RlLnBpZCxcclxuICB9O1xyXG4gIG5vZGUucGlkID0gZGVsTm9kZS5pZDtcclxuICByZXR1cm4gZGVsTm9kZTtcclxufSIsICJpbXBvcnQgeyBjb250ZXh0IH0gZnJvbSBcImVzYnVpbGRcIjtcclxuaW1wb3J0IHsgRWxlbWVudE5vZGUsIEhUTUxOb2RlVHlwZSB9IGZyb20gXCIuLi9jb3JlL3R5cGVzXCI7XHJcbmltcG9ydCB7IGlzRXF1YWxFbGVtZW50VHlwZSB9IGZyb20gXCIuLi9jb3JlL3V0aWxzXCI7XHJcbmltcG9ydCAge2NyZWF0ZUluc05vZGUsIGNyZWF0ZURlbE5vZGV9IGZyb20gJy4uL2NvcmUvaHRtbFBhcnNlcidcclxuXHJcbmVudW0gRGlmZlR5cGUge1xyXG4gICAgYWRkZWQsXHJcbiAgICByZW1vdmVkXHJcbn1cclxuLyoqIGFsbCBmb3IgYXN0ICovXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1EaWZmKGFzdCwgY29udGV4dCkge1xyXG4gICAgLy8gXHU2OEMwXHU2N0U1XHU4MjgyXHU3MEI5XHU2NjJGXHU1NDI2XHU2NzA5XHU1REVFXHU1RjAyXHU1MzE2XHVGRjBDXHU4RkRCXHU4ODRDXHU3NkY4XHU1RTk0XHU1OTA0XHU3NDA2XHJcbiAgICBjb25zdCBkaWZmQXN0ID0gY29udGV4dC5kaWZmQXN0O1xyXG4gICAgY29uc3Qgb2xkU3RhY2sgPSBbZGlmZkFzdF07XHJcbiAgICBjb25zdCBuZXdTdGFjayA9IFthc3RdO1xyXG4gICAgY29uc3QgcGFyZW50TWFwID0ge307IC8vXHU3MjM2XHU4MjgyXHU3MEI5aWQgPT4gXHU3MjM2XHU4MjgyXHU3MEI5XHJcbiAgICBjb25zdCBwZWRkaW5nTWFwID0ge307IC8vXHU1Rjg1XHU2NENEXHU0RjVDXHU4MjgyXHU3MEI5XHJcbiAgICBcclxuICAgIHdoaWxlKG9sZFN0YWNrLmxlbmd0aCB8fCBuZXdTdGFjay5sZW5ndGgpIHtcclxuICAgICAgICBsZXQgaXNQdXNoQ2hpbGRyZW4gPSB0cnVlOyAvL1x1NjYyRlx1NTQyNlx1NTJBMFx1NTE2NVx1NUI1MFx1ODI4Mlx1NzBCOSxcdTlFRDhcdThCQTRcdTRFM0F0cnVlXHJcbiAgICAgICAgbGV0IG9sZE5vZGUgPSBvbGRTdGFjay5wb3AoKTtcclxuICAgICAgICBsZXQgbmV3Tm9kZSA9IG5ld1N0YWNrLnBvcCgpO1xyXG5cclxuICAgICAgICAvL1x1NUI1OFx1NTBBOFx1NzIzNlx1ODI4Mlx1NzBCOVx1NUYxNVx1NzUyOCAtIFx1NTFDRlx1NUMxMVx1ODI4Mlx1NzBCOVx1NTE4NVx1NUI1OFxyXG4gICAgICAgIGNvbnN0IG9sZFBhcmVudE5vZGUgPSBvbGROb2RlICYmIHBhcmVudE1hcFtvbGROb2RlLnBpZF07XHJcbiAgICAgICAgY29uc3QgbmV3UGFyZW50Tm9kZSA9IG5ld05vZGUgJiYgcGFyZW50TWFwW25ld05vZGUucGlkXTtcclxuXHJcbiAgICAgICAgaWYob2xkTm9kZSkge1xyXG4gICAgICAgICAgICBwYXJlbnRNYXBbb2xkTm9kZS5pZF0gPSBvbGROb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihuZXdOb2RlKSB7XHJcbiAgICAgICAgICAgIHBhcmVudE1hcFtuZXdOb2RlLmlkXSA9IG5ld05vZGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihvbGROb2RlICYmIG5ld05vZGUpIHtcclxuICAgICAgICAgICAgLy9cdTgyODJcdTcwQjlcdTc2RjhcdTU0MENcdUZGMENcdTRFRTNcdTg4NjhcdTY1RTdcdTgyODJcdTcwQjlcdTU0OENcdTY1QjBcdTgyODJcdTcwQjlcdTdDN0JcdTU3OEJcdTRFMDBcdTgxRjRcclxuICAgICAgICAgICAgaWYoaXNFcXVhbEVsZW1lbnRUeXBlKG9sZE5vZGUsIG5ld05vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICBpZihvbGROb2RlLnR5cGUgPT09IEhUTUxOb2RlVHlwZS5UZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYob2xkTm9kZS5jb250ZW50ICE9PSBuZXdOb2RlLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG9sZE5vZGUsIERpZmZUeXBlLnJlbW92ZWQpLCBuZXdQYXJlbnROb2RlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG5ld05vZGUsIERpZmZUeXBlLmFkZGVkKSwgbmV3UGFyZW50Tm9kZSwgbmV3Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYob2xkTm9kZS50eXBlID09PSBIVE1MTm9kZVR5cGUuRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKG9sZE5vZGUudGFnTmFtZSAhPT0gbmV3Tm9kZS50YWdOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTm9kZVx1ODI4Mlx1NzBCOVx1N0M3Qlx1NTc4Qlx1NEUwRFx1NzZGOFx1N0I0OVx1RkYwQ1x1NkJENFx1NTk4Mlx1NTE0M1x1N0QyMFx1NjgwN1x1N0I3RVx1NTQwRFx1NEUwRFx1NEUwMFx1ODFGNFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1B1c2hDaGlsZHJlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUob2xkTm9kZSwgRGlmZlR5cGUucmVtb3ZlZCksIG5ld1BhcmVudE5vZGUsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUobmV3Tm9kZSwgRGlmZlR5cGUuYWRkZWQpLCBuZXdQYXJlbnROb2RlLCBuZXdOb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL1x1ODI4Mlx1NzBCOVx1NEUwRFx1NTQwQ1xyXG4gICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG9sZE5vZGUsIERpZmZUeXBlLnJlbW92ZWQpLCBuZXdQYXJlbnROb2RlLCBudWxsKTtcclxuICAgICAgICAgICAgICAgIGluc2VydChhZGREaWZmVHlwZShuZXdOb2RlLCBEaWZmVHlwZS5hZGRlZCksIG5ld1BhcmVudE5vZGUsIG5ld05vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2UgaWYob2xkTm9kZSkge1xyXG4gICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUob2xkTm9kZSwgRGlmZlR5cGUucmVtb3ZlZCksIG9sZFBhcmVudE5vZGUsIG9sZE5vZGUpO1xyXG4gICAgICAgIH1lbHNlIGlmKG5ld05vZGUpIHtcclxuICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG5ld05vZGUsIERpZmZUeXBlLmFkZGVkKSwgbmV3UGFyZW50Tm9kZSwgbmV3Tm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKG9sZE5vZGUgJiYgKG9sZE5vZGUudHlwZSA9PT0gSFRNTE5vZGVUeXBlLkVsZW1lbnQgfHwgb2xkTm9kZS50eXBlID09PSBIVE1MTm9kZVR5cGUuUm9vdCkgJiYgaXNQdXNoQ2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgb2xkU3RhY2sucHVzaCguLi5vbGROb2RlLmNoaWxkcmVuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYobmV3Tm9kZSAmJiAobmV3Tm9kZS50eXBlID09PSBIVE1MTm9kZVR5cGUuRWxlbWVudCB8fCBuZXdOb2RlLnR5cGUgPT09IEhUTUxOb2RlVHlwZS5Sb290KSAmJiBpc1B1c2hDaGlsZHJlbikge1xyXG4gICAgICAgICAgICBuZXdTdGFjay5wdXNoKC4uLm5ld05vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAgLy8gXHU2MjY3XHU4ODRDXHU2M0QyXHU1MTY1XHU2NENEXHU0RjVDXHJcbiAgICAvLyBmb3IgKGNvbnN0IHBhcmVudCBpbiBwYXJlbnRNYXApIHtcclxuICAgIC8vICAgICBpZiAocGFyZW50TWFwLmhhc093blByb3BlcnR5KHBhcmVudCkpIHtcclxuICAgIC8vICAgICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IHBhcmVudE1hcFtwYXJlbnRdO1xyXG4gICAgLy8gICAgICAgICBpZiAocGFyZW50Tm9kZSkge1xyXG4gICAgLy8gICAgICAgICAgICAgd2hpbGUgKHBhcmVudE5vZGUuZmlyc3RDaGlsZCkge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocGFyZW50Tm9kZS5maXJzdENoaWxkKTtcclxuICAgIC8vICAgICAgICAgICAgIH1cclxuICAgIC8vICAgICAgICAgICAgIHBhcmVudE5vZGUuYXBwZW5kKC4uLnBhcmVudE1hcFtwYXJlbnRdLmNoaWxkcmVuKTtcclxuICAgIC8vICAgICAgICAgfVxyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYWRkRGlmZlR5cGUobm9kZSwgZGlmZlR5cGUpIHtcclxuICAgIG5vZGUuZGlmZlR5cGUgPSBkaWZmVHlwZTtcclxuICAgIC8vIFx1NUJGOVx1NURFRVx1NUYwMlx1NTMxNlx1ODI4Mlx1NzBCOVx1OEZEQlx1ODg0Q1x1NTkwNFx1NzQwNlx1RkYwQ1x1NEY4Qlx1NTk4Mlx1NkRGQlx1NTJBMGluc1x1NjIxNmRlbFx1NjgwN1x1N0I3RVxyXG4gICAgY29uc3QgZGlmZk5vZGUgPSBjcmVhdGVEaWZmTm9kZShub2RlKTtcclxuICAgIHJldHVybiBkaWZmTm9kZTtcclxufVxyXG5mdW5jdGlvbiBjcmVhdGVEaWZmTm9kZShub2RlKSB7XHJcbiAgICAvLyBcdTY4MzlcdTYzNkVcdTVERUVcdTVGMDJcdTdDN0JcdTU3OEJcdTUyMUJcdTVFRkFcdTc2RjhcdTVFOTRcdTc2ODRcdTVERUVcdTVGMDJcdTgyODJcdTcwQjlcclxuICAgIGlmIChub2RlLmRpZmZUeXBlID09PSBEaWZmVHlwZS5hZGRlZCkge1xyXG4gICAgICAgIC8vIFx1NTIxQlx1NUVGQWluc1x1ODI4Mlx1NzBCOVxyXG4gICAgICAgIHJldHVybiBjcmVhdGVJbnNOb2RlKG5vZGUpO1xyXG4gICAgfSBlbHNlIGlmIChub2RlLmRpZmZUeXBlID09PSBEaWZmVHlwZS5yZW1vdmVkKSB7XHJcbiAgICAgICAgLy8gXHU1MjFCXHU1RUZBZGVsXHU4MjgyXHU3MEI5XHJcbiAgICAgICAgcmV0dXJuIGNyZWF0ZURlbE5vZGUobm9kZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFx1NEUwRFx1OTcwMFx1ODk4MVx1NURFRVx1NUYwMlx1NTMxNlx1NTkwNFx1NzQwNlx1NzY4NFx1ODI4Mlx1NzBCOVx1RkYwQ1x1NEZERFx1NjMwMVx1NTM5Rlx1NjgzN1xyXG4gICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gaW5zZXJ0KG5ld05vZGUsIGNvbnRhaW5lciwgYW5jaG9yKSB7XHJcbiAgICBpZihhbmNob3IpIHtcclxuICAgICAgICAvL1x1NTk4Mlx1Njc5Q1x1NjcwOVx1ODI4Mlx1NzBCOVx1NURGMlx1N0VDRlx1NjI3RVx1NTIzMFxyXG4gICAgICAgIGNvbnN0IGZpbmROb2RlSW5kZXggPSBjb250YWluZXIuY2hpbGRyZW4uZmluZEluZGV4KChub2RlKSA9PiBub2RlID09PSBhbmNob3IpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jaGlsZHJlbi5zcGxpY2UoZmluZE5vZGVJbmRleCwgMSwgbmV3Tm9kZSk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgY29udGFpbmVyLmNoaWxkcmVuLnVuc2hpZnQobmV3Tm9kZSk7XHJcbiAgICB9XHJcbn0iLCAiXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1UZXh0KG5vZGUsIGNvbnRleHQpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiBwb3N0Zm9ybVRleHQoKSB7XHJcbiAgICAgICAgY29uc3QgeyB0YWcsIHByb3BzIH0gPSBub2RlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vXHU4RjZDXHU2MzYyXHU2NTg3XHU2NzJDXHU4MjgyXHU3MEI5XHJcbiAg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
