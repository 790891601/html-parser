// packages/core/utils/constants.ts
var CONFIG = {
  idx: BigInt(1)
  //可变配置变量
};

// packages/core/utils/element.ts
function isEqualElementType(element, elementThen) {
  if (element.type === elementThen.type) {
    return true;
  }
  return false;
}

// packages/core/tokenize.ts
function createInsNode(node, options) {
  const insNode = {
    id: CONFIG.idx++,
    type: "Element" /* Element */,
    tagName: "ins",
    attrs: [...options.newAttrs],
    children: [node],
    pid: node.pid
  };
  node.pid = insNode.id;
  return insNode;
}
function createDelNode(node, options) {
  const delNode = {
    id: CONFIG.idx++,
    type: "Element" /* Element */,
    tagName: "del",
    attrs: [...options.oldAttrs],
    children: [node],
    pid: node.pid
  };
  node.pid = delNode.id;
  return delNode;
}

// packages/transform/transformDiff.ts
var parentMap = {};
function transformDiffPlugin(options) {
  parentMap = {};
  const _options = Object.assign({
    oldAttrs: [],
    //外部属性
    newAttrs: []
  }, options);
  return function transformDiff(ast, context) {
    const diffAst = context.diffAst;
    const oldStack = [diffAst];
    const newStack = [ast];
    while (oldStack.length || newStack.length) {
      let oldNode = oldStack.shift();
      let newNode = newStack.shift();
      if (newNode) {
        parentMap[newNode.id] = newNode;
      }
      const newParentNode = newNode && parentMap[newNode.pid];
      const oldParentNode = oldNode && parentMap[oldNode.pid];
      const oldToNewNode = oldNode && parentMap[oldNode.id];
      if (oldNode && newNode) {
        if (isEqualElementType(oldNode, newNode)) {
          if (oldNode.type === "Text" /* Text */) {
            if (oldNode.content !== newNode.content) {
              insert(addDiffType(oldNode, 1 /* removed */, _options), oldParentNode, oldToNewNode);
              insert(addDiffType(newNode, 0 /* added */, _options), newParentNode, newNode);
            }
          } else if (oldNode.type === "Element" /* Element */) {
            if (oldNode.tagName !== newNode.tagName) {
              insert(addDiffType(oldNode, 1 /* removed */, _options), oldParentNode, oldToNewNode);
              insert(addDiffType(newNode, 0 /* added */, _options), newParentNode, newNode);
            } else {
              diffAttributes(oldNode, newNode);
            }
          } else {
          }
        } else {
          insert(addDiffType(oldNode, 1 /* removed */, _options), oldParentNode, oldToNewNode);
          insert(addDiffType(newNode, 0 /* added */, _options), newParentNode, newNode);
        }
      } else if (oldNode) {
        insert(addDiffType(oldNode, 1 /* removed */, _options), oldParentNode, oldToNewNode);
      } else if (newNode) {
        insert(addDiffType(newNode, 0 /* added */, _options), newParentNode, newNode);
      }
      if (oldNode && (oldNode.type === "Element" /* Element */ && !oldNode.unary || oldNode.type === "Root" /* Root */)) {
        oldStack.push(...oldNode.children);
      }
      if (newNode && (newNode.type === "Element" /* Element */ && !newNode.unary || newNode.type === "Root" /* Root */)) {
        newStack.push(...newNode.children);
      }
    }
    return () => {
    };
  };
}
function diffAttributes(oldNode, newNode) {
  const oldAttributes = oldNode.attrs;
  const newAttributes = newNode.attrs;
  const addedAttributes = [];
  const removedAttributes = [];
  const updatedAttributes = [];
  for (const attribute of oldAttributes) {
    if (!newAttributes.some((attr) => attr.name === attribute.name)) {
      removedAttributes.push(attribute);
    }
  }
  for (const attribute of newAttributes) {
    if (!oldAttributes.some((attr) => attr.name === attribute.name)) {
      addedAttributes.push(attribute);
    }
  }
  for (const oldAttr of oldAttributes) {
    const newAttr = newAttributes.find((attr) => attr.name === oldAttr.name);
    if (newAttr && newAttr.value !== oldAttr.value) {
      updatedAttributes.push(newAttr);
    }
  }
  if (addedAttributes.length > 0 || removedAttributes.length > 0 || updatedAttributes.length > 0) {
    oldNode.diffAttributes = {
      added: addedAttributes,
      removed: removedAttributes,
      updated: updatedAttributes
    };
    newNode.diffAttributes = {
      added: addedAttributes,
      removed: removedAttributes,
      updated: updatedAttributes
    };
  }
}
function addDiffType(node, diffType, options) {
  node.diffType = diffType;
  const diffNode = createDiffNode(node, options);
  if (parentMap[diffNode.id]) {
    parentMap[diffNode.id] = diffNode;
  }
  return diffNode;
}
function createDiffNode(node, options = {}) {
  if (node.diffType === 0 /* added */) {
    const insNode = createInsNode(node, options);
    return insNode;
  } else if (node.diffType === 1 /* removed */) {
    const delNode = createDelNode(node, options);
    return delNode;
  } else {
    return node;
  }
}
function insert(newNode, container, anchor) {
  if (anchor) {
    const findNodeIndex = container.children.findIndex((node) => node === anchor);
    container.children.splice(findNodeIndex, 1, newNode);
  } else {
    if (container) {
      if (container.children) {
        container.children.push(newNode);
      } else {
        const containerParent = parentMap[container.pid];
        if (containerParent && containerParent.children) {
          containerParent.children.push(newNode);
        }
      }
    }
  }
}

// packages/transform/transformText.ts
function transformText(node, context) {
  return function postformText() {
    const { tag, props } = node;
  };
}
export {
  transformDiffPlugin,
  transformText
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vcGFja2FnZXMvY29yZS91dGlscy9jb25zdGFudHMudHMiLCAiLi4vLi4vcGFja2FnZXMvY29yZS91dGlscy9lbGVtZW50LnRzIiwgIi4uLy4uL3BhY2thZ2VzL2NvcmUvdG9rZW5pemUudHMiLCAiLi4vLi4vcGFja2FnZXMvdHJhbnNmb3JtL3RyYW5zZm9ybURpZmYudHMiLCAiLi4vLi4vcGFja2FnZXMvdHJhbnNmb3JtL3RyYW5zZm9ybVRleHQudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImV4cG9ydCBjb25zdCBMRUdFTkRTID0ge1xyXG4gICAgJ0FEREVEJzogJ2FkZGVkJyxcclxuICAgICdSRU1PVkVEJzogJ3JlbW92ZWQnLFxyXG59XHJcbmV4cG9ydCBjb25zdCBDT05GSUcgPSB7XHJcbiAgICBpZHg6IEJpZ0ludCgxKSwgLy9cdTUzRUZcdTUzRDhcdTkxNERcdTdGNkVcdTUzRDhcdTkxQ0ZcclxufVxyXG4vL1x1OTFDRFx1N0Y2RWlkeFxyXG5leHBvcnQgY29uc3QgcmVzZXRDb25maWdJZHggPSAoKSA9PiB7XHJcbiAgICBDT05GSUcuaWR4ID0gQmlnSW50KDEpO1xyXG59XHJcblxyXG4vL1x1NTIwN1x1NjM2Mlx1NjU4N1x1NjcyQ1x1NkEyMVx1NUYwRlxyXG5leHBvcnQgY29uc3QgdG9nZ2xlTW9kZSA9IChjb250ZXh0LCBtb2RlKSA9PiB7XHJcbiAgICBjb250ZXh0Lm9sZE1vZGUgPSBjb250ZXh0Lm1vZGU7XHJcbiAgICBjb250ZXh0Lm1vZGUgPSBtb2RlO1xyXG59XHJcbi8vXHU2MDYyXHU1OTBEXHU2QTIxXHU1RjBGXHJcbmV4cG9ydCBjb25zdCByZXZlcnRNb2RlID0gKGNvbnRleHQpID0+IHtcclxuICAgIGNvbnRleHQubW9kZSA9IGNvbnRleHQub2xkTW9kZTtcclxufVxyXG4iLCAiaW1wb3J0IHtUYWdTdGF0ZX0gZnJvbSAnLi4vdHlwZXMnXHJcblxyXG5leHBvcnQgY29uc3QgdW5hcnkgPSBbXHJcbiAgXCJiclwiLFxyXG4gIFwiaHJcIixcclxuICBcImltZ1wiLFxyXG4gIFwiaW5wdXRcIixcclxuICBcIm1ldGFcIixcclxuICBcImxpbmtcIixcclxuICBcImFyZWFcIixcclxuICBcImJhc2VcIixcclxuICBcImNvbFwiLFxyXG4gIFwiY29tbWFuZFwiLFxyXG4gIFwiZW1iZWRcIixcclxuICBcImtleWdlblwiLFxyXG4gIFwicGFyYW1cIixcclxuICBcInNvdXJjZVwiLFxyXG4gIFwidHJhY2tcIixcclxuICBcIndiclwiXHJcbl07XHJcbmV4cG9ydCBmdW5jdGlvbiBpc1VuYXJ5KHRhZ05hbWUpOiBib29sZWFuIHtcclxuICByZXR1cm4gdW5hcnkuaW5jbHVkZXModGFnTmFtZSk7XHJcbn1cclxuICBcclxuLypcdTdFRDNcdTY3NUZcdTY4MDdcdTdCN0UqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VFbGVtZW50KGVsZW1lbnQpIHtcclxuICBpZihlbGVtZW50LnVuYXJ5KSB7XHJcbiAgICBlbGVtZW50LnRhZ1N0YXR1cyA9IFRhZ1N0YXRlLnRhZ0VuZDtcclxuICB9XHJcbn1cclxuLyoqXHJcbiAqIFx1NUJGOVx1NkJENFx1NTE0M1x1N0QyMFx1NjYyRlx1NTQyNlx1NzZGOFx1NTQwQ1x1N0M3Qlx1NTc4QlxyXG4gKiBAcGFyYW0gZWxlbWVudCBcclxuICogQHBhcmFtIGVsZW1lbnRUaGVuIFxyXG4gKiBAcmV0dXJucyBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0VxdWFsRWxlbWVudFR5cGUoZWxlbWVudCwgZWxlbWVudFRoZW4pOiBib29sZWFuIHtcclxuICBpZihlbGVtZW50LnR5cGUgPT09IGVsZW1lbnRUaGVuLnR5cGUpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICByZXR1cm4gZmFsc2U7XHJcbn0iLCAiaW1wb3J0IHthZHZhbmNlQnksIGFkdmFuY2VTcGFjZXMsIGlzVW5hcnksIHRvZ2dsZU1vZGUsIHJldmVydE1vZGUsIENPTkZJRywgcmVzZXRDb25maWdJZHggfSBmcm9tICcuL3V0aWxzL2luZGV4J1xyXG5pbXBvcnQge19wYXJzZXJPcHRpb25zLCBwYXJzZXJDb250ZXh0LCBIVE1MTm9kZVR5cGUsIEVsZW1lbnROb2RlLCBUZXh0Tm9kZSwgQ29tbWVudE5vZGUsIE5vZGUsIFRhZ1N0YXRlLCBUZXh0TW9kZXN9IGZyb20gJy4vdHlwZXMnXHJcblxyXG5jb25zdCBlbGVtZW50UkUgPSAvXlxccyooPzo8XFwvXFxzKihbXj5cXHNcXC9dKilcXHMqPnw8KFtePlxcc1xcL10qKVxccyooW148Pl0qPykoXFwvPyk+KS87XHJcbi8vIGNvbnN0IHZhbHVlZEF0dHJpYnV0ZVJFID0gLyhbP118KD8hXFxkfC17Mn18LVxcZClbYS16QS1aMC05XFx1MDBBMC1cXHVGRkZGLV86ISUtLn48XSspPT8oPzpbXCJdKFteXCJdKilbXCJdfFsnXShbXiddKilbJ118W3tdKFtefV0qKVt9XSk/L2dtcztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b2tlbml6ZShjb250ZXh0OiBwYXJzZXJDb250ZXh0KSB7XHJcbiAgbGV0IHRva2VuczogYW55W10gPSBbXTtcclxuXHJcbiAgd2hpbGUgKGNvbnRleHQuc291cmNlKSB7XHJcbiAgICBjb25zdCB7bW9kZSwgc291cmNlfSA9IGNvbnRleHQ7XHJcbiAgICBsZXQgdG9rZW5cclxuICAgIGlmIChtb2RlID09PSBUZXh0TW9kZXMuREFUQSB8fCBtb2RlID09PSBUZXh0TW9kZXMuUkNEQVRBKSB7XHJcbiAgICAgIC8vIFx1NTNFQVx1NjcwOSBEQVRBIFx1NkEyMVx1NUYwRlx1NjI0RFx1NjUyRlx1NjMwMVx1NjgwN1x1N0I3RVx1ODI4Mlx1NzBCOVx1NzY4NFx1ODlFM1x1Njc5MFxyXG4gICAgICBpZiAoc291cmNlLnN0YXJ0c1dpdGgoXCI8IVtDREFUQVtcIikpIHtcclxuICAgICAgICAvLyBDREFUQVxyXG4gICAgICAgIHRvZ2dsZU1vZGUoY29udGV4dCwgVGV4dE1vZGVzLkNEQVRBKTtcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfWVsc2UgaWYobW9kZSA9PT0gVGV4dE1vZGVzLkRBVEEgJiYgc291cmNlWzBdID09PSBcIjxcIikge1xyXG4gICAgICAgIGlmKHNvdXJjZVsxXSA9PT0gJyEnKSB7XHJcbiAgICAgICAgICBpZiAoc291cmNlLnN0YXJ0c1dpdGgoXCI8IS0tXCIpKSB7XHJcbiAgICAgICAgICAgIC8vXHU2Q0U4XHU5MUNBXHJcbiAgICAgICAgICAgIHRva2VuID0gcGFyc2VDb21tZW50KGNvbnRleHQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNlIGlmKC9bYS16QS1aXS9pLnRlc3Qoc291cmNlWzFdKSkge1xyXG4gICAgICAgICAgLy8gXHU4OUUzXHU2NzkwXHU1RjAwXHU1OUNCXHU2ODA3XHU3QjdFXHJcbiAgICAgICAgICB0b2tlbiA9IHBhcnNlU3RhcnRUYWcoY29udGV4dCk7XHJcbiAgICAgICAgfWVsc2UgaWYoc291cmNlWzFdID09PSAnLycpIHtcclxuICAgICAgICAgIC8vXHU3RUQzXHU2NzVGXHU2ODA3XHU3QjdFXHU3MkI2XHU2MDAxXHJcbiAgICAgICAgICB0b2tlbiA9IHBhcnNlRW5kVGFnKGNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfWVsc2UgaWYgKG1vZGUgPT09IFRleHRNb2Rlcy5SQ0RBVEEgfHwgbW9kZSA9PT0gVGV4dE1vZGVzLkRBVEEgJiYgc291cmNlWzFdID09PSBcIi9cIikge1xyXG4gICAgICAgIC8vXHU3RUQzXHU2NzVGXHU2ODA3XHU3QjdFXHVGRjBDXHU4RkQ5XHU5MUNDXHU5NzAwXHU4OTgxXHU2MjlCXHU1MUZBXHU5NTE5XHU4QkVGXHVGRjBDXHU1NDBFXHU2NTg3XHU0RjFBXHU4QkU2XHU3RUM2XHU4OUUzXHU5MUNBXHU1MzlGXHU1NkUwXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiXHU0RTBEXHU2NjJGREFUQVx1NkEyMVx1NUYwRlwiKTtcclxuICAgICAgfWVsc2UgaWYoc291cmNlLnN0YXJ0c1dpdGgoXCJ7e1wiKSkge1xyXG4gICAgICAgIC8vXHU2M0QyXHU1MDNDXHU4OUUzXHU2Nzg0XHJcbiAgICAgICAgdG9rZW4gPSBwYXJzZUludGVycG9sYXRpb24oY29udGV4dCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gbm9kZSBcdTRFMERcdTVCNThcdTU3MjhcdUZGMENcdThCRjRcdTY2MEVcdTU5MDRcdTRFOEVcdTUxNzZcdTRFRDZcdTZBMjFcdTVGMEZcdUZGMENcdTUzNzNcdTk3NUUgREFUQSBcdTZBMjFcdTVGMEZcdTRFMTRcdTk3NUUgUkNEQVRBIFx1NkEyMVx1NUYwRlxyXG4gICAgICBpZighdG9rZW4pIHtcclxuICAgICAgICB0b2tlbiA9IHBhcnNlVGV4dChjb250ZXh0KTtcclxuICAgICAgfVxyXG4gICAgICB0b2tlbnMucHVzaCh0b2tlbik7XHJcbiAgICB9ZWxzZSBpZihtb2RlID09PSBUZXh0TW9kZXMuQ0RBVEEpIHtcclxuICAgICAgaWYgKHNvdXJjZS5zdGFydHNXaXRoKFwiPCFbQ0RBVEFbXCIpKSB7XHJcbiAgICAgICAgLy8gQ0RBVEFcclxuICAgICAgICB0b2tlbiA9IHBhcnNlQ0RBVEEoY29udGV4dCk7XHJcbiAgICAgICAgcmV2ZXJ0TW9kZShjb250ZXh0KTtcclxuICAgICAgfVxyXG4gICAgICB0b2tlbnMucHVzaCh0b2tlbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdG9rZW5zO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gcGFyc2VTdGFydFRhZyhjb250ZXh0OiBwYXJzZXJDb250ZXh0KSB7XHJcbiAgICBjb25zdCB0YWc6IGFueSA9IHtcclxuICAgICAgaWQ6IENPTkZJRy5pZHgrKyxcclxuICAgICAgdHlwZTogVGFnU3RhdGUudGFnT3BlbixcclxuICAgICAgdGFnTmFtZTogJycsXHJcbiAgICAgIGF0dHJzOiBbXSxcclxuICAgICAgdW5hcnk6IGZhbHNlLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBlbE1hdGNoID0gY29udGV4dC5zb3VyY2UubWF0Y2goZWxlbWVudFJFKTtcclxuXHJcbiAgICBpZihlbE1hdGNoKSB7XHJcbiAgICAgICAgY29uc3QgdGFnTmFtZSA9IGVsTWF0Y2hbMl07XHJcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGVsTWF0Y2hbM107XHJcbiAgICAgICAgY29uc3Qgc2VsZkNsb3NlID0gZWxNYXRjaFs0XTtcclxuXHJcbiAgICAgICAgdGFnLnRhZ05hbWUgPSB0YWdOYW1lO1xyXG4gICAgICAgIHRhZy5hdHRycyA9IHBhcnNlQXR0cmlidXRlcyhhdHRyaWJ1dGVzKTtcclxuICAgICAgICBpZihzZWxmQ2xvc2UpIHtcclxuICAgICAgICAgICAgaWYoIWlzVW5hcnkodGFnTmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlx1NTM1NVx1NjgwN1x1N0I3RVx1NEUwRFx1NTQwOFx1NkNENVwiKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRhZy51bmFyeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRhZy50eXBlID0gVGFnU3RhdGUudGFnTmFtZVxyXG4gICAgICAgIH1cclxuICAgICAgICBhZHZhbmNlQnkoY29udGV4dCwgZWxNYXRjaFswXS5sZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRhZztcclxuICB9XHJcbiAgXHJcbiAgZnVuY3Rpb24gcGFyc2VFbmRUYWcoY29udGV4dCkge1xyXG4gICAgY29uc3QgdGFnRW5kOiBhbnkgPSB7XHJcbiAgICAgICAgdHlwZTogVGFnU3RhdGUudGFnRW5kLFxyXG4gICAgICAgIHRhZ05hbWU6ICcnLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IGVsTWF0Y2ggPSBjb250ZXh0LnNvdXJjZS5tYXRjaChlbGVtZW50UkUpO1xyXG5cclxuICAgIGlmKGVsTWF0Y2gpIHtcclxuICAgICAgICBjb25zdCB0YWdOYW1lID0gZWxNYXRjaFsxXTtcclxuICAgICAgICB0YWdFbmQudGFnTmFtZSA9IHRhZ05hbWU7XHJcbiAgICAgICAgYWR2YW5jZUJ5KGNvbnRleHQsIGVsTWF0Y2hbMF0ubGVuZ3RoKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0YWdFbmRcclxuICB9XHJcbiAgXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUF0dHJpYnV0ZXMoaW5wdXQpIHtcclxuICAgIGNvbnN0IGF0dHJpYnV0ZXM6IGFueVtdID0gW107XHJcbiAgXHJcbiAgICAvLyBcdTkwMUFcdThGQzdcdTZCNjNcdTUyMTlcdTg4NjhcdThGQkVcdTVGMEZcdTYzRDBcdTUzRDZcdTVDNUVcdTYwMjdcdTU0MERcdTU0OENcdTVDNUVcdTYwMjdcdTUwM0NcclxuICAgIGNvbnN0IHJlZ2V4ID0gLyhcXHcrKVxccyo9XFxzKig/OlwiKFteXCJdKilcInwnKFteJ10qKSd8KFtePlxcc10qKSkvZztcclxuICAgIGxldCBtYXRjaDtcclxuICAgIFxyXG4gICAgd2hpbGUgKChtYXRjaCA9IHJlZ2V4LmV4ZWMoaW5wdXQpKSAhPT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBhdHRyaWJ1dGUgPSB7XHJcbiAgICAgICAgbmFtZTogbWF0Y2hbMV0sXHJcbiAgICAgICAgdmFsdWU6IG1hdGNoWzJdIHx8IG1hdGNoWzNdIHx8IG1hdGNoWzRdXHJcbiAgICAgIH07XHJcbiAgXHJcbiAgICAgIGF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgcmV0dXJuIGF0dHJpYnV0ZXM7XHJcbn1cclxuICBcclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVGV4dChjb250ZXh0KSB7XHJcbiAgICBsZXQge3NvdXJjZX0gPSBjb250ZXh0O1xyXG4gICAgLy9cdTUzMzlcdTkxNERcdTdFQUZcdTY1ODdcdTY3MkNcclxuICAgIGNvbnN0IG1hdGNoID0gc291cmNlLm1hdGNoKC9bXjw+XSovKTtcclxuICAgIGxldCBjb250ZW50ID0gJyc7XHJcbiAgICBpZihtYXRjaFswXSkge1xyXG4gICAgICBhZHZhbmNlQnkoY29udGV4dCwgbWF0Y2hbMF0ubGVuZ3RoKTtcclxuICAgICAgY29udGVudCA9IG1hdGNoWzBdO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaWQ6IENPTkZJRy5pZHgrKyxcclxuICAgICAgICB0eXBlOiBIVE1MTm9kZVR5cGUuVGV4dCxcclxuICAgICAgICBjb250ZW50OiBjb250ZW50LFxyXG4gICAgfTtcclxufVxyXG5cclxuLy9cdTZDRThcdTkxQ0FcclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQ29tbWVudChjb250ZXh0KSB7XHJcbiAgICBsZXQge3NvdXJjZX0gPSBjb250ZXh0O1xyXG4gICAgbGV0IHZhbHVlID0gJyc7IC8vXHU2Q0U4XHU5MUNBXHU1MTg1XHU1QkI5XHJcbiAgXHJcbiAgICBzb3VyY2UgPSBzb3VyY2Uuc2xpY2UoNCk7XHJcbiAgICBzb3VyY2UgPSBzb3VyY2UucmVwbGFjZSgvKFtcXHNcXFNdKj8pKC0tPikvLCBmdW5jdGlvbihtYXRjaCwgJDEsICQyKSB7XHJcbiAgICAgIHZhbHVlID0gJDE7XHJcbiAgICAgIHJldHVybiAkMiA/ICQyIDogJyc7XHJcbiAgICB9KTtcclxuICAgIGlmKHNvdXJjZS5zdGFydHNXaXRoKFwiLS0+XCIpKSB7XHJcbiAgICAgIGNvbnRleHQuc291cmNlID0gc291cmNlLnNsaWNlKDMpO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICAvL1x1NjIxNlx1ODAwNVx1NjI0Qlx1NTJBOFx1OTVFRFx1NTQwOFxyXG4gICAgICB2YWx1ZSA9IGNvbnRleHQuc291cmNlO1xyXG4gICAgICBjb250ZXh0LnNvdXJjZSA9ICcnO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IENPTkZJRy5pZHgrKyxcclxuICAgICAgdHlwZTogSFRNTE5vZGVUeXBlLkNvbW1lbnQsXHJcbiAgICAgIGNvbnRlbnQ6IHZhbHVlLFxyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNEQVRBKGNvbnRleHQpIHtcclxuICAgIGNvbnN0IGNkYXRhTWF0Y2ggPSBjb250ZXh0LnNvdXJjZS5tYXRjaCgvXjwhXFxbQ0RBVEFcXFsoW1xcc1xcU10qPylcXF1cXF0vKTtcclxuICAgIGFkdmFuY2VCeShjb250ZXh0LCBjZGF0YU1hdGNoWzBdLmxlbmd0aCk7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkOiBDT05GSUcuaWR4KyssXHJcbiAgICAgIHR5cGU6IEhUTUxOb2RlVHlwZS5DREFUQSxcclxuICAgICAgY29udGVudDogY2RhdGFNYXRjaFsxXVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUludGVycG9sYXRpb24oY29udGV4dCkge1xyXG4gICAgY29uc3Qge3NvdXJjZX0gPSBjb250ZXh0O1xyXG4gICAgY29uc3QgbWF0Y2ggPSBzb3VyY2UubWF0Y2goL15cXHtcXHtcXHMqKC4qPylcXHMqXFx9XFx9Lyk7XHJcbiAgICBhZHZhbmNlQnkoY29udGV4dCwgbWF0Y2hbMF0ubGVuZ3RoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpZDogQ09ORklHLmlkeCsrLFxyXG4gICAgICB0eXBlOiBIVE1MTm9kZVR5cGUuSW50ZXJwb2xhdGlvbixcclxuICAgICAgY29udGVudDogW21hdGNoWzBdLCBtYXRjaFsxXV0sXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbnNOb2RlKG5vZGUsIG9wdGlvbnMpIHtcclxuICAgIC8vIFx1NTIxQlx1NUVGQWluc1x1ODI4Mlx1NzBCOVx1RkYwQ1x1NUU3Nlx1NTkwRFx1NTIzNlx1NTM5Rlx1ODI4Mlx1NzBCOVx1NzY4NFx1NUM1RVx1NjAyN1x1NTQ4Q1x1NUI1MFx1ODI4Mlx1NzBCOVxyXG4gICAgY29uc3QgaW5zTm9kZTogRWxlbWVudE5vZGUgPSB7XHJcbiAgICAgICAgaWQ6IENPTkZJRy5pZHgrKyxcclxuICAgICAgICB0eXBlOiBIVE1MTm9kZVR5cGUuRWxlbWVudCxcclxuICAgICAgICB0YWdOYW1lOiAnaW5zJyxcclxuICAgICAgICBhdHRyczogWy4uLm9wdGlvbnMubmV3QXR0cnNdLFxyXG4gICAgICAgIGNoaWxkcmVuOiBbbm9kZV0sXHJcbiAgICAgICAgcGlkOiBub2RlLnBpZCxcclxuICAgIH07XHJcbiAgICBub2RlLnBpZCA9IGluc05vZGUuaWQ7XHJcbiAgICByZXR1cm4gaW5zTm9kZTtcclxuICB9XHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlbE5vZGUobm9kZSwgb3B0aW9ucykge1xyXG4gICAgLy8gXHU1MjFCXHU1RUZBZGVsXHU4MjgyXHU3MEI5XHVGRjBDXHU1RTc2XHU1OTBEXHU1MjM2XHU1MzlGXHU4MjgyXHU3MEI5XHU3Njg0XHU1QzVFXHU2MDI3XHU1NDhDXHU1QjUwXHU4MjgyXHU3MEI5XHJcbiAgICBjb25zdCBkZWxOb2RlOiBFbGVtZW50Tm9kZSA9IHtcclxuICAgICAgICBpZDogQ09ORklHLmlkeCsrLFxyXG4gICAgICAgIHR5cGU6IEhUTUxOb2RlVHlwZS5FbGVtZW50LFxyXG4gICAgICAgIHRhZ05hbWU6ICdkZWwnLFxyXG4gICAgICAgIGF0dHJzOiBbLi4ub3B0aW9ucy5vbGRBdHRyc10sXHJcbiAgICAgICAgY2hpbGRyZW46IFtub2RlXSxcclxuICAgICAgICBwaWQ6IG5vZGUucGlkLFxyXG4gICAgfTtcclxuICAgIG5vZGUucGlkID0gZGVsTm9kZS5pZDtcclxuICAgIHJldHVybiBkZWxOb2RlO1xyXG4gIH0iLCAiaW1wb3J0IHsgY29udGV4dCB9IGZyb20gXCJlc2J1aWxkXCI7XHJcbmltcG9ydCB7IEVsZW1lbnROb2RlLCBIVE1MTm9kZVR5cGUgfSBmcm9tIFwiLi4vY29yZS90eXBlc1wiO1xyXG5pbXBvcnQgeyBpc0VxdWFsRWxlbWVudFR5cGUgfSBmcm9tIFwiLi4vY29yZS91dGlsc1wiO1xyXG5pbXBvcnQgIHtjcmVhdGVJbnNOb2RlLCBjcmVhdGVEZWxOb2RlfSBmcm9tICcuLi9jb3JlL3Rva2VuaXplJ1xyXG5cclxuZW51bSBEaWZmVHlwZSB7XHJcbiAgICBhZGRlZCxcclxuICAgIHJlbW92ZWRcclxufVxyXG5cclxubGV0IHBhcmVudE1hcCA9IHt9OyAvL1x1NzIzNlx1ODI4Mlx1NzBCOWlkID0+IFx1NzIzNlx1ODI4Mlx1NzBCOVxyXG4vKiogYWxsIGZvciBhc3QgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybURpZmZQbHVnaW4ob3B0aW9ucykge1xyXG4gICAgcGFyZW50TWFwID0ge307XHJcbiAgICBjb25zdCBfb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xyXG4gICAgICAgIG9sZEF0dHJzOiBbXSwgLy9cdTU5MTZcdTkwRThcdTVDNUVcdTYwMjdcclxuICAgICAgICBuZXdBdHRyczogW10sXHJcbiAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gdHJhbnNmb3JtRGlmZihhc3QsIGNvbnRleHQpIHtcclxuICAgICAgICAvLyBcdTY4QzBcdTY3RTVcdTgyODJcdTcwQjlcdTY2MkZcdTU0MjZcdTY3MDlcdTVERUVcdTVGMDJcdTUzMTZcdUZGMENcdThGREJcdTg4NENcdTc2RjhcdTVFOTRcdTU5MDRcdTc0MDZcclxuICAgICAgICBjb25zdCBkaWZmQXN0ID0gY29udGV4dC5kaWZmQXN0O1xyXG4gICAgICAgIGNvbnN0IG9sZFN0YWNrID0gW2RpZmZBc3RdO1xyXG4gICAgICAgIGNvbnN0IG5ld1N0YWNrID0gW2FzdF07XHJcblxyXG4gICAgICAgIHdoaWxlKG9sZFN0YWNrLmxlbmd0aCB8fCBuZXdTdGFjay5sZW5ndGgpIHsgLy9cdTgxRUFcdTk4NzZcdTU0MTFcdTRFMEJcclxuICAgICAgICAgICAgbGV0IG9sZE5vZGUgPSBvbGRTdGFjay5zaGlmdCgpO1xyXG4gICAgICAgICAgICBsZXQgbmV3Tm9kZSA9IG5ld1N0YWNrLnNoaWZ0KCk7XHJcblxyXG4gICAgICAgICAgICBpZihuZXdOb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnRNYXBbbmV3Tm9kZS5pZF0gPSBuZXdOb2RlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1BhcmVudE5vZGUgPSBuZXdOb2RlICYmIHBhcmVudE1hcFtuZXdOb2RlLnBpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZFBhcmVudE5vZGUgPSBvbGROb2RlICYmIHBhcmVudE1hcFtvbGROb2RlLnBpZF07XHJcbiAgICAgICAgICAgIGNvbnN0IG9sZFRvTmV3Tm9kZSA9IG9sZE5vZGUgJiYgcGFyZW50TWFwW29sZE5vZGUuaWRdO1xyXG5cclxuICAgICAgICAgICAgaWYob2xkTm9kZSAmJiBuZXdOb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAvL1x1ODI4Mlx1NzBCOVx1NzZGOFx1NTQwQ1x1RkYwQ1x1NEVFM1x1ODg2OFx1NjVFN1x1ODI4Mlx1NzBCOVx1NTQ4Q1x1NjVCMFx1ODI4Mlx1NzBCOVx1N0M3Qlx1NTc4Qlx1NEUwMFx1ODFGNFxyXG4gICAgICAgICAgICAgICAgaWYoaXNFcXVhbEVsZW1lbnRUeXBlKG9sZE5vZGUsIG5ld05vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYob2xkTm9kZS50eXBlID09PSBIVE1MTm9kZVR5cGUuVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihvbGROb2RlLmNvbnRlbnQgIT09IG5ld05vZGUuY29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cdTVFOTRcdThCRTVcdTUzQkJcdTYyN0VcdTUyMzBcdTY1RTdcdTgyODJcdTcwQjlcdTc2ODRcdTRGNERcdTdGNkUsXHU3MTM2XHU1NDBFXHU2NUIwXHU4MjgyXHU3MEI5XHU1QzMxXHU1M0VGXHU0RUU1XHU2NTNFXHU1MjMwXHU1MzlGXHU2NzY1XHU3Njg0XHU0RjREXHU3RjZFXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUob2xkTm9kZSwgRGlmZlR5cGUucmVtb3ZlZCwgX29wdGlvbnMpLCBvbGRQYXJlbnROb2RlLCBvbGRUb05ld05vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG5ld05vZGUsIERpZmZUeXBlLmFkZGVkLCBfb3B0aW9ucyksIG5ld1BhcmVudE5vZGUsIG5ld05vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYob2xkTm9kZS50eXBlID09PSBIVE1MTm9kZVR5cGUuRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihvbGROb2RlLnRhZ05hbWUgIT09IG5ld05vZGUudGFnTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Ob2RlXHU4MjgyXHU3MEI5XHU3QzdCXHU1NzhCXHU0RTBEXHU3NkY4XHU3QjQ5XHVGRjBDXHU2QkQ0XHU1OTgyXHU1MTQzXHU3RDIwXHU2ODA3XHU3QjdFXHU1NDBEXHU0RTBEXHU0RTAwXHU4MUY0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUob2xkTm9kZSwgRGlmZlR5cGUucmVtb3ZlZCwgX29wdGlvbnMpLCBvbGRQYXJlbnROb2RlLCBvbGRUb05ld05vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG5ld05vZGUsIERpZmZUeXBlLmFkZGVkLCBfb3B0aW9ucyksIG5ld1BhcmVudE5vZGUsIG5ld05vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmQXR0cmlidXRlcyhvbGROb2RlLCBuZXdOb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9cdTgyODJcdTcwQjlcdTc2RjhcdTU0MEMsXHU0RTBEXHU0RkVFXHU2NTM5XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vXHU4MjgyXHU3MEI5XHU0RTBEXHU1NDBDXHJcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0KGFkZERpZmZUeXBlKG9sZE5vZGUsIERpZmZUeXBlLnJlbW92ZWQsIF9vcHRpb25zKSwgb2xkUGFyZW50Tm9kZSwgb2xkVG9OZXdOb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnNlcnQoYWRkRGlmZlR5cGUobmV3Tm9kZSwgRGlmZlR5cGUuYWRkZWQsIF9vcHRpb25zKSwgbmV3UGFyZW50Tm9kZSwgbmV3Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfWVsc2UgaWYob2xkTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgLy9cdTUzRUFcdTY3MDlcdTY1RTdcdTgyODJcdTcwQjlcclxuICAgICAgICAgICAgICAgIGluc2VydChhZGREaWZmVHlwZShvbGROb2RlLCBEaWZmVHlwZS5yZW1vdmVkLCBfb3B0aW9ucyksIG9sZFBhcmVudE5vZGUsIG9sZFRvTmV3Tm9kZSk7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKG5ld05vZGUpIHtcclxuICAgICAgICAgICAgICAgIGluc2VydChhZGREaWZmVHlwZShuZXdOb2RlLCBEaWZmVHlwZS5hZGRlZCwgX29wdGlvbnMpLCBuZXdQYXJlbnROb2RlLCBuZXdOb2RlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYob2xkTm9kZSAmJiAoKG9sZE5vZGUudHlwZSA9PT0gSFRNTE5vZGVUeXBlLkVsZW1lbnQgJiYgIW9sZE5vZGUudW5hcnkpIHx8IG9sZE5vZGUudHlwZSA9PT0gSFRNTE5vZGVUeXBlLlJvb3QpKSB7XHJcbiAgICAgICAgICAgICAgICBvbGRTdGFjay5wdXNoKC4uLm9sZE5vZGUuY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG5ld05vZGUgJiYgKChuZXdOb2RlLnR5cGUgPT09IEhUTUxOb2RlVHlwZS5FbGVtZW50ICYmICFuZXdOb2RlLnVuYXJ5KSB8fCBuZXdOb2RlLnR5cGUgPT09IEhUTUxOb2RlVHlwZS5Sb290KSApIHtcclxuICAgICAgICAgICAgICAgIG5ld1N0YWNrLnB1c2goLi4ubmV3Tm9kZS5jaGlsZHJlbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZGlmZkF0dHJpYnV0ZXMob2xkTm9kZSwgbmV3Tm9kZSkge1xyXG4gICAgY29uc3Qgb2xkQXR0cmlidXRlcyA9IG9sZE5vZGUuYXR0cnM7XHJcbiAgICBjb25zdCBuZXdBdHRyaWJ1dGVzID0gbmV3Tm9kZS5hdHRycztcclxuXHJcbiAgICBjb25zdCBhZGRlZEF0dHJpYnV0ZXM6IGFueVtdID0gW107XHJcbiAgICBjb25zdCByZW1vdmVkQXR0cmlidXRlczogYW55W10gPSBbXTtcclxuICAgIGNvbnN0IHVwZGF0ZWRBdHRyaWJ1dGVzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIC8vIFx1NjdFNVx1NjI3RVx1NjVCMFx1NTg5RVx1NzY4NFx1NTQ4Q1x1NURGMlx1NTIyMFx1OTY2NFx1NzY4NFx1NUM1RVx1NjAyN1xyXG4gICAgZm9yIChjb25zdCBhdHRyaWJ1dGUgb2Ygb2xkQXR0cmlidXRlcykge1xyXG4gICAgICAgIGlmICghbmV3QXR0cmlidXRlcy5zb21lKGF0dHIgPT4gYXR0ci5uYW1lID09PSBhdHRyaWJ1dGUubmFtZSkpIHtcclxuICAgICAgICAgICAgcmVtb3ZlZEF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgYXR0cmlidXRlIG9mIG5ld0F0dHJpYnV0ZXMpIHtcclxuICAgICAgICBpZiAoIW9sZEF0dHJpYnV0ZXMuc29tZShhdHRyID0+IGF0dHIubmFtZSA9PT0gYXR0cmlidXRlLm5hbWUpKSB7XHJcbiAgICAgICAgICAgIGFkZGVkQXR0cmlidXRlcy5wdXNoKGF0dHJpYnV0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFx1NjdFNVx1NjI3RVx1NjZGNFx1NjVCMFx1NzY4NFx1NUM1RVx1NjAyN1x1RkYwOFx1NUM1RVx1NjAyN1x1NTQwRFx1NzZGOFx1NTQwQ1x1NEY0Nlx1NTAzQ1x1NEUwRFx1NTQwQ1x1RkYwOVxyXG4gICAgZm9yIChjb25zdCBvbGRBdHRyIG9mIG9sZEF0dHJpYnV0ZXMpIHtcclxuICAgICAgICBjb25zdCBuZXdBdHRyID0gbmV3QXR0cmlidXRlcy5maW5kKGF0dHIgPT4gYXR0ci5uYW1lID09PSBvbGRBdHRyLm5hbWUpO1xyXG4gICAgICAgIGlmIChuZXdBdHRyICYmIG5ld0F0dHIudmFsdWUgIT09IG9sZEF0dHIudmFsdWUpIHtcclxuICAgICAgICAgICAgdXBkYXRlZEF0dHJpYnV0ZXMucHVzaChuZXdBdHRyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gXHU2ODA3XHU4QkIwXHU4MjgyXHU3MEI5XHU3Njg0XHU1QzVFXHU2MDI3XHU1REVFXHU1RjAyXHJcbiAgICBpZiAoYWRkZWRBdHRyaWJ1dGVzLmxlbmd0aCA+IDAgfHwgcmVtb3ZlZEF0dHJpYnV0ZXMubGVuZ3RoID4gMCB8fCB1cGRhdGVkQXR0cmlidXRlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgb2xkTm9kZS5kaWZmQXR0cmlidXRlcyA9IHtcclxuICAgICAgICAgICAgYWRkZWQ6IGFkZGVkQXR0cmlidXRlcyxcclxuICAgICAgICAgICAgcmVtb3ZlZDogcmVtb3ZlZEF0dHJpYnV0ZXMsXHJcbiAgICAgICAgICAgIHVwZGF0ZWQ6IHVwZGF0ZWRBdHRyaWJ1dGVzXHJcbiAgICAgICAgfTtcclxuICAgICAgICBuZXdOb2RlLmRpZmZBdHRyaWJ1dGVzID0ge1xyXG4gICAgICAgICAgICBhZGRlZDogYWRkZWRBdHRyaWJ1dGVzLFxyXG4gICAgICAgICAgICByZW1vdmVkOiByZW1vdmVkQXR0cmlidXRlcyxcclxuICAgICAgICAgICAgdXBkYXRlZDogdXBkYXRlZEF0dHJpYnV0ZXNcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhZGREaWZmVHlwZShub2RlLCBkaWZmVHlwZSwgb3B0aW9ucykge1xyXG4gICAgbm9kZS5kaWZmVHlwZSA9IGRpZmZUeXBlO1xyXG4gICAgLy8gXHU1QkY5XHU1REVFXHU1RjAyXHU1MzE2XHU4MjgyXHU3MEI5XHU4RkRCXHU4ODRDXHU1OTA0XHU3NDA2XHVGRjBDXHU0RjhCXHU1OTgyXHU2REZCXHU1MkEwaW5zXHU2MjE2ZGVsXHU2ODA3XHU3QjdFXHJcbiAgICBjb25zdCBkaWZmTm9kZSA9IGNyZWF0ZURpZmZOb2RlKG5vZGUsIG9wdGlvbnMpO1xyXG4gICAgaWYocGFyZW50TWFwW2RpZmZOb2RlLmlkXSkge1xyXG4gICAgICAgIHBhcmVudE1hcFtkaWZmTm9kZS5pZF0gPSBkaWZmTm9kZTtcclxuICAgIH1cclxuICAgIHJldHVybiBkaWZmTm9kZTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlRGlmZk5vZGUobm9kZSwgb3B0aW9ucz17fSkge1xyXG4gICAgLy8gXHU2ODM5XHU2MzZFXHU1REVFXHU1RjAyXHU3QzdCXHU1NzhCXHU1MjFCXHU1RUZBXHU3NkY4XHU1RTk0XHU3Njg0XHU1REVFXHU1RjAyXHU4MjgyXHU3MEI5XHJcbiAgICBpZiAobm9kZS5kaWZmVHlwZSA9PT0gRGlmZlR5cGUuYWRkZWQpIHtcclxuICAgICAgICAvLyBcdTUyMUJcdTVFRkFpbnNcdTgyODJcdTcwQjlcclxuICAgICAgICBjb25zdCBpbnNOb2RlOiBFbGVtZW50Tm9kZSA9IGNyZWF0ZUluc05vZGUobm9kZSwgb3B0aW9ucylcclxuICAgICAgICByZXR1cm4gaW5zTm9kZVxyXG4gICAgfSBlbHNlIGlmIChub2RlLmRpZmZUeXBlID09PSBEaWZmVHlwZS5yZW1vdmVkKSB7XHJcbiAgICAgICAgLy8gXHU1MjFCXHU1RUZBZGVsXHU4MjgyXHU3MEI5XHJcbiAgICAgICAgY29uc3QgZGVsTm9kZTogRWxlbWVudE5vZGUgPSBjcmVhdGVEZWxOb2RlKG5vZGUsIG9wdGlvbnMpXHJcbiAgICAgICAgcmV0dXJuIGRlbE5vZGU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFx1NEUwRFx1OTcwMFx1ODk4MVx1NURFRVx1NUYwMlx1NTMxNlx1NTkwNFx1NzQwNlx1NzY4NFx1ODI4Mlx1NzBCOVx1RkYwQ1x1NEZERFx1NjMwMVx1NTM5Rlx1NjgzN1xyXG4gICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gaW5zZXJ0KG5ld05vZGUsIGNvbnRhaW5lciwgYW5jaG9yKSB7XHJcbiAgICBpZihhbmNob3IpIHtcclxuICAgICAgICAvL1x1NTk4Mlx1Njc5Q1x1NjcwOVx1ODI4Mlx1NzBCOVx1NURGMlx1N0VDRlx1NjI3RVx1NTIzMFxyXG4gICAgICAgIGNvbnN0IGZpbmROb2RlSW5kZXggPSBjb250YWluZXIuY2hpbGRyZW4uZmluZEluZGV4KChub2RlKSA9PiBub2RlID09PSBhbmNob3IpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jaGlsZHJlbi5zcGxpY2UoZmluZE5vZGVJbmRleCwgMSwgbmV3Tm9kZSk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgICAgaWYoY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGlmKGNvbnRhaW5lci5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmNoaWxkcmVuLnB1c2gobmV3Tm9kZSk7XHJcbiAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclBhcmVudCA9IHBhcmVudE1hcFtjb250YWluZXIucGlkXTtcclxuICAgICAgICAgICAgICAgIGlmKGNvbnRhaW5lclBhcmVudCAmJiBjb250YWluZXJQYXJlbnQuY2hpbGRyZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXJQYXJlbnQuY2hpbGRyZW4ucHVzaChuZXdOb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsICJcclxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybVRleHQobm9kZSwgY29udGV4dCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIHBvc3Rmb3JtVGV4dCgpIHtcclxuICAgICAgICBjb25zdCB7IHRhZywgcHJvcHMgfSA9IG5vZGU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9cdThGNkNcdTYzNjJcdTY1ODdcdTY3MkNcdTgyODJcdTcwQjlcclxuICAgIH1cclxufSJdLAogICJtYXBwaW5ncyI6ICI7QUFJTyxJQUFNLFNBQVM7QUFBQSxFQUNsQixLQUFLLE9BQU8sQ0FBQztBQUFBO0FBQ2pCOzs7QUM4Qk8sU0FBUyxtQkFBbUIsU0FBUyxhQUFzQjtBQUNoRSxNQUFHLFFBQVEsU0FBUyxZQUFZLE1BQU07QUFDcEMsV0FBTztBQUFBLEVBQ1Q7QUFDQSxTQUFPO0FBQ1Q7OztBQzhJTyxTQUFTLGNBQWMsTUFBTSxTQUFTO0FBRXpDLFFBQU0sVUFBdUI7QUFBQSxJQUN6QixJQUFJLE9BQU87QUFBQSxJQUNYO0FBQUEsSUFDQSxTQUFTO0FBQUEsSUFDVCxPQUFPLENBQUMsR0FBRyxRQUFRLFFBQVE7QUFBQSxJQUMzQixVQUFVLENBQUMsSUFBSTtBQUFBLElBQ2YsS0FBSyxLQUFLO0FBQUEsRUFDZDtBQUNBLE9BQUssTUFBTSxRQUFRO0FBQ25CLFNBQU87QUFDVDtBQUNPLFNBQVMsY0FBYyxNQUFNLFNBQVM7QUFFM0MsUUFBTSxVQUF1QjtBQUFBLElBQ3pCLElBQUksT0FBTztBQUFBLElBQ1g7QUFBQSxJQUNBLFNBQVM7QUFBQSxJQUNULE9BQU8sQ0FBQyxHQUFHLFFBQVEsUUFBUTtBQUFBLElBQzNCLFVBQVUsQ0FBQyxJQUFJO0FBQUEsSUFDZixLQUFLLEtBQUs7QUFBQSxFQUNkO0FBQ0EsT0FBSyxNQUFN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
